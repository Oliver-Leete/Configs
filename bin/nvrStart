#!/bin/bash

if [[ "$(wmctrl -d | grep '*')" == *"PhD"* ]]; then
    serverID="nvimsynctex"
    winTitle="MainEditor (Synctex)"
else
    serverID="nvr-server-$(kitty @ ls | jq ".[].tabs[] | select(.is_focused) | .id")"
    winTitle="MainEditor"
fi

TITLES=$(kitty @ ls | jq ".[].tabs[] | select(.is_focused) | .windows[].title")

if ! [[ "$TITLES" == *"$winTitle"* ]]; then
	kitty @ set-window-title $winTitle
else
	ID=$(kitty @ ls | jq ".[].tabs[] | select(.is_focused) | .windows[] | select(.title==\"$winTitle\") | .id")
	kitty @ focus-window --match id:$ID
fi

nvr -s --servername "/tmp/$serverID" $@
