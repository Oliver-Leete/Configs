#!/bin/bash

WINTITLE=$1

TITLES=$(kitty @ ls | jq ".[] | select(.is_focused) | .tabs[] | select(.is_focused) | .windows[].title")

if ! [[ "$TITLES" =~ \"$WINTITLE\" ]]; then
    kitty @ launch --type=window --window-title="$WINTITLE" --keep-focus $2
fi

ID=$(kitty @ ls | jq ".[] | select(.is_focused) | .tabs[] | select(.is_focused) | .windows[] | select(.title==\"$WINTITLE\") | .id")

cat - | pee "ifne -n kitty @ focus-window --match id:$ "kitty @ send-text --match id:$ID --stdin"
